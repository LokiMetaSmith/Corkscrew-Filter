# NASA Technical Memorandum: Analysis of Corkscrew Filter Autonomous Design Framework

**Date:** October 26, 2023
**Subject:** Technical Evaluation of the Parametric Corkscrew Filter Repository
**Target Audience:** Technical Review Board, Open Source Community

---

## Abstract

This report provides a comprehensive technical analysis of the "Corkscrew Filter" repository, a software-defined engineering project capable of autonomously designing, simulating, and optimizing inertial filtration devices. The system integrates three distinct technical domains: parametric Computer-Aided Design (CAD) using OpenSCAD, Computational Fluid Dynamics (CFD) using OpenFOAM, and Generative Artificial Intelligence (AI) using Large Language Models (LLMs). This evaluation focuses on the software architecture, physics simulation fidelity, and the efficacy of the agentic control loop. The analysis confirms the existence of a functional "Hardware-in-the-Loop" simulation pipeline where an AI agent iteratively modifies geometry based on physics feedback.

## 1. Introduction

The objective of the Corkscrew Filter project is to develop a modular, high-efficiency inertial filter system using a helical (corkscrew) geometry. Unlike traditional iterative design, which relies on manual human modification, this project implements an inverse design methodology. A central software controller generates geometry, validates it through virtual wind tunnel testing (CFD), and employs an AI agent to determine the optimal parameters for the subsequent iteration.

This report assesses the technical merit of the repository, specifically analyzing:
1.  The modularity and robustness of the parametric geometry generation.
2.  The validity of the automated CFD mesh generation and solver settings.
3.  The logic and implementation of the AI-driven optimization loop.

## 2. System Architecture

The system operates as a closed-loop feedback mechanism managed by a Python-based orchestrator (`optimizer/main.py`). The workflow proceeds as follows:

1.  **Generation:** The `ScadDriver` compiles parametric configurations into a stereolithography (STL) mesh using OpenSCAD.
2.  **Meshing:** The `FoamDriver` processes the STL into a hexahedral-dominant CFD mesh using `snappyHexMesh`.
3.  **Simulation:** The `simpleFoam` solver executes a steady-state flow simulation to determine pressure drop and velocity fields.
4.  **Feedback:** The `LLMAgent` analyzes the performance metrics against defined constraints and provides a new set of parameters via the Google Gemini API.

[Figure 1: System Architecture Diagram - Data Flow between OpenSCAD, OpenFOAM, and LLM Agent]

## 3. Subsystem Analysis: Parametric Modeling (OpenSCAD)

The geometric modeling is performed by OpenSCAD, a script-based CAD modeler. The codebase has evolved from a monolithic structure to a highly modular library.

### 3.1. Modularity and Structure
The primary entry point, `corkscrew.scad`, acts as a dispatcher, invoking specific modules based on the `part_to_generate` configuration variable. The geometry logic is encapsulated in the `modules/` directory:

*   **`modules/core.scad`:** Contains the fundamental `HelicalShape` module. It uses the `linear_extrude` function with a `twist` parameter to generate the corkscrew geometry. A key feature is the ability to generate both the positive solid (for printing) and the negative void (for CFD fluid extraction) via the boolean `GENERATE_CFD_VOLUME` flag.
*   **`modules/inlets.scad`:** Integrates the `BOSL2` library to generate ISO-standard threading and parametric hose barbs, ensuring physical compatibility with standard plumbing hardware.
*   **`config.scad`:** Centralizes all design parameters (e.g., `tube_od_mm`, `helix_path_radius_mm`, `twist`), enabling the Python optimizer to programmatically modify the design by overriding these variables.

### 3.2. Geometric Complexity
The system supports complex geometric operations, including:
*   **Variable Pitch/Twist:** Controlled by `number_of_complete_revolutions` and `insert_length_mm`.
*   **Profile Scaling:** The `helix_profile_scale_ratio` parameter allows for elliptical cross-sections, optimizing surface area within a fixed cylindrical volume.
*   **Interference Checks:** The `ModularFilterAssembly` handles boolean subtractions to ensure the helical channel does not intersect with structural supports or inlets.

[Figure 2: Wireframe view of Helical Geometry generated by OpenSCAD]

## 4. Subsystem Analysis: Computational Fluid Dynamics (OpenFOAM)

The simulation environment is built upon OpenFOAM v2406. The automation logic resides in `optimizer/foam_driver.py`.

### 4.1. Mesh Generation
Meshing helical geometries is non-trivial due to high curvature. The system employs `snappyHexMesh` with the following characteristics:
*   **Refinement:** A surface refinement level of 2 is applied to the corkscrew geometry.
*   **Boundary Layers:** The configuration enables `addLayers` with 3 surface layers, which is critical for capturing boundary layer separation and skin friction near the helical walls.
*   **Patch Detection:** The driver script uses `autoPatch` with an 80-degree feature angle to automatically segregate the inlet, outlet, and wall patches from the raw STL file.

### 4.2. Physics and Solver
The solver configuration (`system/controlDict`) specifies `simpleFoam`, a steady-state solver for incompressible, turbulent flow.
*   **Boundary Conditions:**
    *   **Inlet:** Fixed value velocity (5 m/s, Z-axis).
    *   **Outlet:** Zero pressure gradient.
    *   **Walls:** No-slip condition.
*   **Instrumentation:** The `FoamDriver` dynamically injects `functionObjects` (`surfaceFieldValue`) into the `controlDict` if they are missing. This allows the system to automatically extract the area-averaged pressure at the inlet and outlet to calculate Delta P ($$\Delta P$$), the primary optimization metric.

### 4.3. Automation
The `FoamDriver` class abstracts the complexity of OpenFOAM case management. It handles directory cloning (`0.orig` to `0`), log parsing (regex extraction of residuals), and error handling for failed solver runs.

[Figure 3: Velocity streamlines through the helical channel (OpenFOAM Output)]

## 5. Subsystem Analysis: Autonomous Optimization (AI Agent)

The `optimizer/llm_agent.py` module represents the cognitive layer of the system.

### 5.1. Agent Implementation
The agent utilizes the Google Generative AI SDK (specifically the `gemini-1.5-flash` model). It is not a hard-coded heuristic but a generalized reasoning engine.
*   **Context Window:** The agent is provided with a "History of Runs" (a JSON list of previous parameters and their resulting metrics) and a set of "Constraints" (e.g., `tube_od_mm` must be 32).
*   **Prompt Engineering:** The system prompts the model to act as an "expert engineer." The prompt explicitly requests an analysis of trends in the history and a JSON-formatted suggestion for the next parameter set.
*   **Robustness:** The code includes error handling to strip Markdown formatting (e.g., \`\`\`json) from the LLM response, ensuring the orchestrator does not crash due to malformed output.

### 5.2. Optimization Loop
The loop, defined in `main.py`, executes a sequential optimization process:
1.  The agent proposes parameters.
2.  The geometry is generated and simulated.
3.  The performance metrics (Delta P) are fed back into the agent's context.
4.  The cycle repeats, allowing the agent to "learn" the sensitivity of the design space.

## 6. Legacy Code Evolution

A review of the `legacy/` directory (specifically `ThirstyCorkscrew.scad`) reveals significant architectural maturation.
*   **Monolithic vs. Modular:** The legacy code contained all logic in a single file with hardcoded values (`hose_od = 9.5`), making external optimization impossible. The modern version decouples configuration from logic.
*   **Manual vs. Automated:** The legacy approach relied on manual boolean flags (`USE_SCREW_ONLY`) for debugging. The current system uses programmatic flags (`GENERATE_CFD_VOLUME`, `CUT_FOR_VISIBILITY`) that can be toggled by the build system.

## 7. Conclusion and Recommendations

The Corkscrew Filter repository demonstrates a high Technology Readiness Level (TRL) for an automated design framework. It successfully bridges the gap between parametric CAD and high-fidelity CFD using modern AI orchestration.

### 7.1. Technical Merit
*   **Automation:** The pipeline is fully automated, requiring no human intervention between iterations.
*   **Modularity:** The separation of concerns in OpenSCAD allows for easy extension to new geometries (e.g., different inlet types or filter profiles).
*   **Introspection:** The use of `functionObjects` and log parsing allows the system to self-evaluate performance quantitatively.

### 7.2. Recommendations for Improvement
1.  **Turbulence Model Verification:** The repository should explicitly define the turbulence model properties in `constant/turbulenceProperties` (e.g., $k-\epsilon$ or $k-\omega$ SST). Currently, the default OpenFOAM behavior is assumed.
2.  **Convergence Criteria:** The `FoamDriver` runs for a fixed number of iterations. Implementing a residual-based stopping criterion (e.g., stop when residuals < $$10^{-4}$$) would save computational resources.
3.  **Hallucination Guardrails:** While `llm_agent.py` handles JSON parsing errors, it lacks semantic validation. The system should verify that the suggested parameters are within physical bounds (e.g., `screw_ID < screw_OD`) *before* attempting geometry generation to prevent wasted cycles.
4.  **Parallel Execution:** The current loop is sequential. Running multiple simulations in parallel (batch processing) would significantly accelerate the optimization of the high-dimensional parameter space.

---
*End of Document*
